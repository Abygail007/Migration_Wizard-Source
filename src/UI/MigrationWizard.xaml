<Window xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="MigrationWizard - Assistant de Migration"
        Height="700" Width="1000"
        MinHeight="600" MinWidth="800"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResize"
        Background="#0b1220">
  
  <Window.Resources>
    <!-- Couleurs du thème sombre -->
    <SolidColorBrush x:Key="PanelDark" Color="#111827"/>
    <SolidColorBrush x:Key="Ink" Color="#e8eefc"/>
    <SolidColorBrush x:Key="Accent" Color="#263147"/>
    <SolidColorBrush x:Key="AccentLight" Color="#3b4d6b"/>
    <SolidColorBrush x:Key="AccentBlue" Color="#3b82f6"/>
    
    <!-- Styles globaux -->
    <Style TargetType="TextBlock">
      <Setter Property="Foreground" Value="{StaticResource Ink}"/>
      <Setter Property="FontSize" Value="13"/>
    </Style>
    
    <Style TargetType="Label">
      <Setter Property="Foreground" Value="{StaticResource Ink}"/>
      <Setter Property="FontSize" Value="13"/>
    </Style>
    
    <Style TargetType="CheckBox">
      <Setter Property="Foreground" Value="{StaticResource Ink}"/>
      <Setter Property="FontWeight" Value="SemiBold"/>
      <Setter Property="Margin" Value="4"/>
    </Style>
    
    <Style TargetType="Button">
      <Setter Property="Margin" Value="6"/>
      <Setter Property="Padding" Value="12,6"/>
      <Setter Property="Background" Value="{StaticResource Accent}"/>
      <Setter Property="Foreground" Value="{StaticResource Ink}"/>
      <Setter Property="BorderBrush" Value="{StaticResource AccentLight}"/>
      <Setter Property="FontSize" Value="13"/>
      <Setter Property="FontWeight" Value="SemiBold"/>
    </Style>
    
    <Style TargetType="TextBox">
      <Setter Property="Margin" Value="6"/>
      <Setter Property="Padding" Value="6"/>
      <Setter Property="Background" Value="{StaticResource PanelDark}"/>
      <Setter Property="Foreground" Value="{StaticResource Ink}"/>
      <Setter Property="BorderBrush" Value="{StaticResource Accent}"/>
      <Setter Property="FontSize" Value="13"/>
    </Style>
    
    <Style TargetType="TreeView">
      <Setter Property="Background" Value="{StaticResource PanelDark}"/>
      <Setter Property="Foreground" Value="{StaticResource Ink}"/>
      <Setter Property="BorderBrush" Value="{StaticResource Accent}"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="FontSize" Value="13"/>
    </Style>
    
    <Style TargetType="TreeViewItem">
      <Setter Property="Foreground" Value="{StaticResource Ink}"/>
    </Style>
    
    <Style TargetType="GroupBox">
      <Setter Property="Foreground" Value="{StaticResource Ink}"/>
      <Setter Property="BorderBrush" Value="{StaticResource Accent}"/>
      <Setter Property="Margin" Value="0,4,0,4"/>
      <Setter Property="Padding" Value="8"/>
    </Style>
    
    <Style TargetType="RadioButton">
      <Setter Property="Foreground" Value="{StaticResource Ink}"/>
      <Setter Property="FontSize" Value="14"/>
      <Setter Property="FontWeight" Value="SemiBold"/>
      <Setter Property="VerticalAlignment" Value="Center"/>
    </Style>
  </Window.Resources>
  
  <Grid Margin="16">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <!-- En-tête avec logo à droite -->
    <DockPanel Grid.Row="0" Margin="0,0,0,12">
      <!-- Titre à gauche -->
      <StackPanel DockPanel.Dock="Left" VerticalAlignment="Center">
        <TextBlock Text="MigrationWizard" FontSize="24" FontWeight="Bold" Foreground="#e8eefc"/>
        <TextBlock Text="Assistant de Migration Windows" FontSize="14" Foreground="#a8b2d1" Margin="0,4,0,0"/>
      </StackPanel>
      
      <!-- Logo vraiment à droite -->
      <Viewbox DockPanel.Dock="Right" 
               Height="120" 
               HorizontalAlignment="Right"
               VerticalAlignment="Center"
               Stretch="Uniform">
        <Image Name="imgLogoBg"
               Stretch="Uniform"
               RenderOptions.BitmapScalingMode="HighQuality"/>
      </Viewbox>
    </DockPanel>
    
    <!-- Zone de contenu (pages) -->
    <Grid Grid.Row="1" Name="pageHost">

      <!-- PAGE 0 : DASHBOARD RESPONSIVE -->
      <Grid Name="page0" Visibility="Visible">
        <ScrollViewer VerticalScrollBarVisibility="Auto">
          <StackPanel Margin="0,0,0,12">

            <!-- Titre Dashboard compact avec bouton Commencer à droite -->
            <Border CornerRadius="8" Margin="0,0,0,12" Padding="16,12">
              <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                  <GradientStop Color="#3b82f6" Offset="0"/>
                  <GradientStop Color="#8b5cf6" Offset="1"/>
                </LinearGradientBrush>
              </Border.Background>
              <Border.Effect>
                <DropShadowEffect Color="#3b82f6" Opacity="0.4" BlurRadius="15" ShadowDepth="2"/>
              </Border.Effect>
              <DockPanel>
                <TextBlock DockPanel.Dock="Left" Text=" Tableau de bord" FontSize="20" FontWeight="Bold" Foreground="White" VerticalAlignment="Center"/>
                <!-- Bouton Commencer PETIT style rose/violet -->
                <Border DockPanel.Dock="Right"
                        CornerRadius="4"
                        Margin="12,0,0,0"
                        VerticalAlignment="Center"
                        HorizontalAlignment="Right">
                  <Border.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                      <GradientStop Color="#ec4899" Offset="0"/>
                      <GradientStop Color="#a855f7" Offset="1"/>
                    </LinearGradientBrush>
                  </Border.Background>
                  <Button Name="btnDashStart"
                          Content="Commencer"
                          FontSize="10"
                          FontWeight="SemiBold"
                          Padding="16,3"
                          Background="Transparent"
                          BorderThickness="0"
                          Foreground="White"
                          Cursor="Hand"
                          HorizontalAlignment="Right"/>
                </Border>
              </DockPanel>
            </Border>

            <!-- Stats en 2 lignes de 2 colonnes pour être plus compact -->
            <Grid Margin="0,0,0,12">
              <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
              </Grid.RowDefinitions>
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
              </Grid.ColumnDefinitions>

              <!-- Carte: Total Exports -->
              <Border Grid.Row="0" Grid.Column="0" CornerRadius="8" Padding="12" Margin="0,0,6,6">
                <Border.Background>
                  <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <GradientStop Color="#1e293b" Offset="0"/>
                    <GradientStop Color="#0f172a" Offset="1"/>
                  </LinearGradientBrush>
                </Border.Background>
                <Border.Effect>
                  <DropShadowEffect Color="Black" Opacity="0.2" BlurRadius="10" ShadowDepth="3"/>
                </Border.Effect>
                <DockPanel>
                  <TextBlock DockPanel.Dock="Left" Text="" FontSize="28" VerticalAlignment="Center" Margin="0,0,12,0"/>
                  <StackPanel DockPanel.Dock="Right" VerticalAlignment="Center">
                    <TextBlock Text="EXPORTS" FontSize="10" FontWeight="Bold" Foreground="#64748b"/>
                    <TextBlock Name="txtDashTotalExports" Text="0" FontSize="24" FontWeight="Bold" Foreground="#3b82f6"/>
                  </StackPanel>
                </DockPanel>
              </Border>

              <!-- Carte: Espace disque -->
              <Border Grid.Row="0" Grid.Column="1" CornerRadius="8" Padding="12" Margin="6,0,0,6">
                <Border.Background>
                  <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <GradientStop Color="#1e293b" Offset="0"/>
                    <GradientStop Color="#0f172a" Offset="1"/>
                  </LinearGradientBrush>
                </Border.Background>
                <Border.Effect>
                  <DropShadowEffect Color="Black" Opacity="0.2" BlurRadius="10" ShadowDepth="3"/>
                </Border.Effect>
                <DockPanel>
                  <TextBlock DockPanel.Dock="Left" Text="" FontSize="28" VerticalAlignment="Center" Margin="0,0,12,0"/>
                  <StackPanel DockPanel.Dock="Right" VerticalAlignment="Center">
                    <TextBlock Text="ESPACE" FontSize="10" FontWeight="Bold" Foreground="#64748b"/>
                    <TextBlock Name="txtDashTotalSize" Text="0 GB" FontSize="24" FontWeight="Bold" Foreground="#10b981"/>
                  </StackPanel>
                </DockPanel>
              </Border>

              <!-- Carte: Dernier export -->
              <Border Grid.Row="1" Grid.Column="0" CornerRadius="8" Padding="12" Margin="0,6,6,0">
                <Border.Background>
                  <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <GradientStop Color="#1e293b" Offset="0"/>
                    <GradientStop Color="#0f172a" Offset="1"/>
                  </LinearGradientBrush>
                </Border.Background>
                <Border.Effect>
                  <DropShadowEffect Color="Black" Opacity="0.2" BlurRadius="10" ShadowDepth="3"/>
                </Border.Effect>
                <DockPanel>
                  <TextBlock DockPanel.Dock="Left" Text="" FontSize="28" VerticalAlignment="Center" Margin="0,0,12,0"/>
                  <StackPanel DockPanel.Dock="Right" VerticalAlignment="Center">
                    <TextBlock Text="DERNIER EXPORT" FontSize="10" FontWeight="Bold" Foreground="#64748b"/>
                    <TextBlock Name="txtDashLastExport" Text="Aucun" FontSize="13" FontWeight="SemiBold" Foreground="#f59e0b" TextWrapping="Wrap"/>
                    <TextBlock Name="txtDashLastExportDate" Text="" FontSize="10" Foreground="#475569"/>
                  </StackPanel>
                </DockPanel>
              </Border>

              <!-- Carte: Dernier import -->
              <Border Grid.Row="1" Grid.Column="1" CornerRadius="8" Padding="12" Margin="6,6,0,0">
                <Border.Background>
                  <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <GradientStop Color="#1e293b" Offset="0"/>
                    <GradientStop Color="#0f172a" Offset="1"/>
                  </LinearGradientBrush>
                </Border.Background>
                <Border.Effect>
                  <DropShadowEffect Color="Black" Opacity="0.2" BlurRadius="10" ShadowDepth="3"/>
                </Border.Effect>
                <DockPanel>
                  <TextBlock DockPanel.Dock="Left" Text="" FontSize="28" VerticalAlignment="Center" Margin="0,0,12,0"/>
                  <StackPanel DockPanel.Dock="Right" VerticalAlignment="Center">
                    <TextBlock Text="DERNIER IMPORT" FontSize="10" FontWeight="Bold" Foreground="#64748b"/>
                    <TextBlock Name="txtDashLastImport" Text="Aucun" FontSize="13" FontWeight="SemiBold" Foreground="#8b5cf6" TextWrapping="Wrap"/>
                    <TextBlock Name="txtDashLastImportDate" Text="" FontSize="10" Foreground="#475569"/>
                  </StackPanel>
                </DockPanel>
              </Border>
            </Grid>

            <!-- Section: Liste des exports COMPACTE -->
            <Border CornerRadius="8" Padding="14" Margin="0,0,0,12">
              <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                  <GradientStop Color="#1e293b" Offset="0"/>
                  <GradientStop Color="#0f172a" Offset="1"/>
                </LinearGradientBrush>
              </Border.Background>
              <Border.Effect>
                <DropShadowEffect Color="Black" Opacity="0.2" BlurRadius="10" ShadowDepth="3"/>
              </Border.Effect>
              <StackPanel>
                <DockPanel Margin="0,0,0,10">
                  <StackPanel DockPanel.Dock="Left" Orientation="Horizontal">
                    <TextBlock Text="" FontSize="18" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBlock Text="Exports disponibles" FontSize="16" FontWeight="Bold" VerticalAlignment="Center"/>
                  </StackPanel>
                  <Button Name="btnDashRefresh" DockPanel.Dock="Right"
                          Content=""
                          HorizontalAlignment="Right"
                          Padding="10,6"
                          FontSize="14"
                          Background="#263147"
                          BorderBrush="#3b4d6b"
                          Foreground="White"/>
                </DockPanel>

                <!-- DataGrid des exports -->
                <DataGrid Name="dgDashExports"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          CanUserResizeRows="False"
                          CanUserResizeColumns="True"
                          ColumnHeaderHeight="32"
                          SelectionMode="Single"
                          GridLinesVisibility="Horizontal"
                          HeadersVisibility="Column"
                          Background="{StaticResource PanelDark}"
                          Foreground="{StaticResource Ink}"
                          BorderBrush="{StaticResource Accent}"
                          RowBackground="#1a1f2e"
                          AlternatingRowBackground="#151a27"
                          FontSize="12"
                          MinHeight="180"
                          MaxHeight="280"
                          EnableColumnVirtualization="False"
                          VirtualizingPanel.IsVirtualizing="False">
                  <DataGrid.ColumnHeaderStyle>
                    <Style TargetType="DataGridColumnHeader">
                      <Setter Property="Background" Value="#2d3748"/>
                      <Setter Property="Foreground" Value="#f59e0b"/>
                      <Setter Property="FontWeight" Value="SemiBold"/>
                      <Setter Property="FontSize" Value="13"/>
                      <Setter Property="Padding" Value="8,6"/>
                      <Setter Property="BorderBrush" Value="#4b5563"/>
                      <Setter Property="BorderThickness" Value="0,0,1,1"/>
                      <Setter Property="HorizontalContentAlignment" Value="Left"/>
                    </Style>
                  </DataGrid.ColumnHeaderStyle>
                  <DataGrid.RowStyle>
                    <Style TargetType="DataGridRow">
                      <Setter Property="Cursor" Value="Hand"/>
                      <Style.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                          <Setter Property="Background" Value="#252d3d"/>
                        </Trigger>
                      </Style.Triggers>
                    </Style>
                  </DataGrid.RowStyle>
                  <DataGrid.Columns>
                    <DataGridTextColumn Header="Client" Binding="{Binding ClientName}" Width="120" CanUserResize="True"/>
                    <DataGridTextColumn Header="PC" Binding="{Binding PCName}" Width="140" CanUserResize="True"/>
                    <DataGridTextColumn Header="Type" Binding="{Binding ExportType}" Width="100" CanUserResize="True"/>
                    <DataGridTextColumn Header="Exporté le" Binding="{Binding ExportDate}" Width="120" CanUserResize="True"/>
                    <DataGridTextColumn Header="Importé le" Binding="{Binding ImportDate}" Width="120" CanUserResize="True"/>
                    <DataGridTextColumn Header="Taille" Binding="{Binding SizeGB, StringFormat='{}{0:N2} GB'}" Width="80" CanUserResize="True"/>
                    <DataGridTemplateColumn Header="Actions" Width="320" CanUserResize="False">
                      <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                          <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <Button Name="btnDashImport"
                                    Content="📥 Import"
                                    Tag="{Binding}"
                                    Padding="8,4"
                                    Margin="2,0"
                                    Background="#10b981"
                                    Foreground="White"
                                    BorderBrush="#10b981"
                                    FontSize="11"
                                    Cursor="Hand"/>
                            <Button Name="btnDashIncremental"
                                    Content="📦 Export Inc."
                                    Tag="{Binding}"
                                    Padding="8,4"
                                    Margin="2,0"
                                    Background="#3b82f6"
                                    Foreground="White"
                                    BorderBrush="#3b82f6"
                                    FontSize="11"
                                    Cursor="Hand"/>
                            <Button Name="btnDashDelete"
                                    Content="🗑 Suppr."
                                    Tag="{Binding}"
                                    Padding="8,4"
                                    Margin="2,0"
                                    Background="#ef4444"
                                    Foreground="White"
                                    BorderBrush="#ef4444"
                                    FontSize="11"
                                    Cursor="Hand"/>
                          </StackPanel>
                        </DataTemplate>
                      </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                  </DataGrid.Columns>
                </DataGrid>

                <!-- Message si aucun export -->
                <TextBlock Name="txtDashNoExports"
                           Text="Aucun export trouvé sur les lecteurs disponibles."
                           FontSize="14" Foreground="#6b7280"
                           HorizontalAlignment="Center"
                           Margin="0,20,0,0"
                           Visibility="Collapsed"/>
              </StackPanel>
            </Border>

          </StackPanel>
        </ScrollViewer>
      </Grid>

      <!-- PAGE 1 : Choix Export/Import -->
      <Grid Name="page1" Visibility="Collapsed">
        <ScrollViewer VerticalScrollBarVisibility="Auto">
          <StackPanel Margin="0,0,0,12">
          <TextBlock Text="Que souhaitez-vous faire ?" FontSize="20" FontWeight="Bold" Margin="0,0,0,16"/>
          
          <StackPanel Orientation="Horizontal" Margin="0,0,0,16" HorizontalAlignment="Left">
            <RadioButton Name="rbExport" Content=" Exporter depuis cet ordinateur" IsChecked="True" Margin="6"/>
            <RadioButton Name="rbImport" Content=" Importer vers cet ordinateur" Margin="6"/>
          </StackPanel>
          
          <Border Background="{StaticResource PanelDark}" 
                  BorderBrush="{StaticResource Accent}" 
                  BorderThickness="1" 
                  CornerRadius="8" 
                  Padding="16"
                  Margin="0,16,0,0">
            <StackPanel>
              <TextBlock FontSize="14" FontWeight="Bold" Margin="0,0,0,8">
                i  Informations système
              </TextBlock>
              <TextBlock>
                <Run Text="Utilisateur : "/><Run Name="txtUser" FontWeight="Bold"/>
              </TextBlock>
              <TextBlock>
                <Run Text="Profil : "/><Run Name="txtProfile" Foreground="#a8b2d1"/>
              </TextBlock>
              <TextBlock Foreground="#ffd700" Margin="0,12,0,0">
                !  Conseil : Exécuter en Administrateur pour toutes les fonctionnalités
              </TextBlock>
            </StackPanel>
          </Border>
          </StackPanel>
        </ScrollViewer>
      </Grid>

      <!-- PAGE 1B : Détection exports existants (Export incrémental) -->
      <Grid Name="page1b" Visibility="Collapsed">
        <ScrollViewer VerticalScrollBarVisibility="Auto">
          <StackPanel Margin="0,0,0,12">
            <TextBlock Text="Export pour cet ordinateur" FontSize="20" FontWeight="Bold" Margin="0,0,0,16"/>

            <!-- Question principale -->
            <Border Background="{StaticResource PanelDark}"
                    BorderBrush="{StaticResource Accent}"
                    BorderThickness="2"
                    CornerRadius="8"
                    Padding="20"
                    Margin="0,0,0,20">
              <StackPanel>
                <TextBlock FontSize="16" FontWeight="Bold" Margin="0,0,0,12" Foreground="{StaticResource Accent}">
                   Y a-t-il déjà eu des exports pour ce PC ?
                </TextBlock>
                <TextBlock TextWrapping="Wrap" Margin="0,0,0,16" Foreground="#a8b2d1">
                  Si vous avez déjà exporté les données de cet ordinateur, vous pouvez effectuer un export incrémental (seulement les fichiers modifiés).
                </TextBlock>

                <!-- RadioButtons pour choix mode -->
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Margin="0,8,0,16">
                  <RadioButton Name="rbExportIncrementalOui"
                               Content="OK  Oui, export incrémental"
                               GroupName="ExportMode"
                               Foreground="White"
                               FontSize="14"
                               Margin="0,0,24,0"/>
                  <RadioButton Name="rbExportIncrementalNon"
                               Content="X  Non, premier export complet"
                               GroupName="ExportMode"
                               IsChecked="True"
                               Foreground="White"
                               FontSize="14"/>
                </StackPanel>

                <!-- Sélection client existant (visible si mode incrémental) -->
                <Border Name="borderClientSelection"
                        Visibility="Collapsed"
                        Background="#1a2f1a"
                        BorderBrush="#4a7c2c"
                        BorderThickness="1"
                        CornerRadius="6"
                        Padding="12"
                        Margin="0,0,0,12">
                  <StackPanel>
                    <TextBlock Text="Sélectionner le client à mettre à jour :"
                               FontWeight="Bold"
                               Foreground="#6fdc6f"
                               Margin="0,0,0,8"/>

                    <Grid>
                      <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                      </Grid.ColumnDefinitions>

                      <ComboBox Name="cmbExistingClients"
                                Grid.Column="0"
                                FontSize="13"
                                Padding="8"
                                Margin="0,0,8,0"
                                Background="#0d1117"
                                Foreground="White"
                                BorderBrush="{StaticResource Accent}"
                                BorderThickness="1"/>

                      <Button Name="btnBrowseExistingClient"
                              Grid.Column="1"
                              Content=" Parcourir..."
                              Padding="12,6"
                              FontSize="12"
                              Background="#1a2332"
                              Foreground="White"
                              BorderBrush="{StaticResource Accent}"
                              BorderThickness="1"/>
                    </Grid>
                  </StackPanel>
                </Border>
              </StackPanel>
            </Border>

            <!-- Info mode incrémental -->
            <Border Background="#1a2f1a"
                    BorderBrush="#4a7c2c"
                    BorderThickness="1"
                    CornerRadius="6"
                    Padding="12"
                    Margin="0,0,0,0">
              <StackPanel>
                <TextBlock FontWeight="Bold" Foreground="#6fdc6f" Margin="0,0,0,6">
                  i  Mode Incrémental :
                </TextBlock>
                <TextBlock TextWrapping="Wrap" Foreground="#a8d1a8" FontSize="12">
                  • Documents/Bureau : Copie SEULEMENT les fichiers nouveaux ou modifiés (rapide ! )
                </TextBlock>
                <TextBlock TextWrapping="Wrap" Foreground="#a8d1a8" FontSize="12">
                  • Paramètres système : Réexport complet (Wifi, Imprimantes, RDP, etc.)
                </TextBlock>
                <TextBlock TextWrapping="Wrap" Foreground="#a8d1a8" FontSize="12">
                  • Gain de temps : Jusqu'à 90% plus rapide pour les gros volumes !
                </TextBlock>
              </StackPanel>
            </Border>
          </StackPanel>
        </ScrollViewer>
      </Grid>

      <!-- PAGE 21 : Sélection Client (Import) -->
      <Grid Name="page21" Visibility="Collapsed">
        <ScrollViewer VerticalScrollBarVisibility="Auto">
          <StackPanel Margin="0,0,0,12">
          <TextBlock Text="Sélectionner un client à importer" 
                     FontSize="20" FontWeight="Bold" 
                     Margin="0,0,0,20" Foreground="White"/>
          
          <TextBlock Text="Clients détectés automatiquement :" 
                     Margin="0,0,0,10" Foreground="#CCCCCC"/>
          
          <!-- Liste des clients détectés -->
          <ListBox Name="lstClients" 
                   Height="350" 
                   Margin="0,0,0,20"
                   SelectionMode="Single"
                   Background="{StaticResource PanelDark}"
                   Foreground="White"
                   BorderBrush="{StaticResource AccentBlue}"
                   BorderThickness="2">
            <ListBox.ItemTemplate>
              <DataTemplate>
                <Border Padding="10" Margin="5" 
                        Background="#2A2A2A" 
                        BorderBrush="{StaticResource AccentBlue}" 
                        BorderThickness="1"
                        CornerRadius="5">
                  <StackPanel Orientation="Vertical">
                    <TextBlock Text="{Binding FolderName}" 
                               FontWeight="Bold" 
                               FontSize="14" 
                               Foreground="White"/>
                    <TextBlock Text="{Binding DisplayInfo}" 
                               Foreground="#AAAAAA" 
                               FontSize="11" 
                               Margin="0,5,0,0"/>
                  </StackPanel>
                </Border>
              </DataTemplate>
            </ListBox.ItemTemplate>
          </ListBox>
          
          <!-- Bouton parcourir manuel -->
          <Button Name="btnBrowseClient" 
                  Content=" Parcourir manuellement..." 
                  Padding="15,8" 
                  Margin="0,0,0,20"
                  Background="{StaticResource AccentBlue}"
                  Foreground="White"
                  BorderThickness="0"
                  FontSize="14"
                  Cursor="Hand">
            <Button.Resources>
              <Style TargetType="Border">
                <Setter Property="CornerRadius" Value="5"/>
              </Style>
            </Button.Resources>
          </Button>
          
          <!-- Message d'erreur -->
          <TextBlock Name="txtClientError"
                     Foreground="Orange"
                     Visibility="Collapsed"
                     TextWrapping="Wrap"/>
          </StackPanel>
        </ScrollViewer>
      </Grid>

      <!-- PAGE 2 : Sélection dossiers + Options -->
      <Grid Name="page2" Visibility="Collapsed">
        <ScrollViewer VerticalScrollBarVisibility="Auto">
          <Grid Margin="0,0,0,12">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="2*"/>
              <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

        <!-- Colonne gauche : Dossiers + AppData -->
        <Grid Grid.Column="0" Margin="0,0,8,0">
          <Grid.RowDefinitions>
            <RowDefinition Height="3*"/>
            <RowDefinition Height="2*"/>
          </Grid.RowDefinitions>
          
          <!-- Dossiers à inclure -->
          <GroupBox Grid.Row="0" Header=" Dossiers à inclure" Margin="0,0,0,4">
            <Grid Background="{StaticResource PanelDark}">
              <TreeView Name="treeFolders"
                        ScrollViewer.VerticalScrollBarVisibility="Auto"
                        ScrollViewer.CanContentScroll="True"
                        VirtualizingStackPanel.IsVirtualizing="True"
                        VirtualizingStackPanel.VirtualizationMode="Recycling"/>
            </Grid>
          </GroupBox>
          
          <!-- Options supplémentaires (section séparée) -->
          <GroupBox Grid.Row="1" Header=" Options supplémentaires">
            <Grid Background="{StaticResource PanelDark}">
              <TreeView Name="treeAppData"
                        ScrollViewer.VerticalScrollBarVisibility="Auto"
                        ScrollViewer.CanContentScroll="True"/>
            </Grid>
          </GroupBox>
        </Grid>
        
        <!-- Colonne droite : Options réorganisées -->
        <ScrollViewer Grid.Column="1" VerticalScrollBarVisibility="Auto">
          <StackPanel>
            <GroupBox Header="Cfg  Fonctionnalités Windows">
              <StackPanel Background="{StaticResource PanelDark}">
                <CheckBox Name="cbWifi" Content="Wi-Fi (profils XML)" IsChecked="True"/>
                <CheckBox Name="cbPrinters" Content="Imprimantes (queues)" IsChecked="True"/>
                <CheckBox Name="cbPrinterDrivers" Content="Pilotes d'imprimantes" IsChecked="True"/>
                <CheckBox Name="cbTaskbar" Content="Barre des tâches" IsChecked="True"/>
                <CheckBox Name="cbStartMenu" Content="Menu Démarrer" IsChecked="True"/>
                <CheckBox Name="cbWallpaper" Content="Fond d'écran" IsChecked="True"/>
                <CheckBox Name="cbDesktopPos" Content="Positions d'icônes" IsChecked="True"/>
                <CheckBox Name="cbNetDrives" Content="Lecteurs réseau" IsChecked="True"/>
                <CheckBox Name="cbRDP" Content="Connexions RDP" IsChecked="True"/>
                <CheckBox Name="cbQuickAccess" Content="Accès rapide Explorateur" IsChecked="True"/>
              </StackPanel>
            </GroupBox>
            
            <GroupBox Header=" Navigateurs &amp; Email">
              <StackPanel Background="{StaticResource PanelDark}">
                <CheckBox Name="cbAppChrome" Content="Chrome AppData" IsChecked="True"/>
                <CheckBox Name="cbAppEdge" Content="Edge AppData" IsChecked="True"/>
                <CheckBox Name="cbAppFirefox" Content="Firefox AppData" IsChecked="True"/>
                <CheckBox Name="cbAppOutlook" Content="Outlook AppData" IsChecked="True"/>
              </StackPanel>
            </GroupBox>
            
            <GroupBox Header=" Affichage">
              <StackPanel Background="{StaticResource PanelDark}">
                <CheckBox Name="cbShowHidden" Content="Afficher dossiers cachés" IsChecked="True"/>
              </StackPanel>
            </GroupBox>
            
            <GroupBox Header=" Applications">
              <StackPanel Background="{StaticResource PanelDark}">
                <CheckBox Name="cbInstallApplications"
                          Content="Détecter &amp; installer applications"
                          IsChecked="True"/>
              </StackPanel>
            </GroupBox>

            <GroupBox Header="Cfg  Options copie">
              <StackPanel Background="{StaticResource PanelDark}">
                <CheckBox Name="cbSkipCopy"
                          Content="Ne pas copier de fichiers"
                          IsChecked="False"/>
                <CheckBox Name="cbFilterBig"
                          Content="Exclure ISO/VM/archives"
                          IsChecked="False"/>
              </StackPanel>
            </GroupBox>
          </StackPanel>
        </ScrollViewer>
          </Grid>
        </ScrollViewer>
      </Grid>

      <!-- PAGE APPS : Applications à réinstaller (Import) -->
      <Grid Name="pageApps" Visibility="Collapsed">
        <ScrollViewer VerticalScrollBarVisibility="Auto">
          <Grid Margin="0,0,0,12">
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <StackPanel Grid.Row="0" Margin="0,0,0,16">
          <TextBlock Text=" Applications à réinstaller" 
                     FontSize="20" FontWeight="Bold" 
                     HorizontalAlignment="Center"
                     Margin="0,0,0,8"/>
          <TextBlock Name="lblAppsStatus" 
                     Text="Analyse des logiciels manquants..." 
                     HorizontalAlignment="Center"
                     Foreground="#AAAAAA"/>
        </StackPanel>
        
        <Border Grid.Row="1" 
                Background="{StaticResource PanelDark}" 
                BorderBrush="{StaticResource Accent}" 
                BorderThickness="1" 
                CornerRadius="8" 
                Padding="8"
                Margin="20,0">
          <Grid>
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            <!-- Boutons sélection -->
            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,8">
              <Button Name="btnAppsSelectAll" Content="OK  Tout sélectionner" Padding="10,5" Margin="0,0,8,0"/>
              <Button Name="btnAppsSelectNone" Content="X  Tout désélectionner" Padding="10,5" Margin="0,0,8,0"/>
              <TextBlock Name="lblAppsCount" VerticalAlignment="Center" Margin="16,0,0,0" Foreground="#AAAAAA"/>
            </StackPanel>
            
            <!-- Liste des applications -->
            <ListView Name="lstAppsToInstall" 
                      Grid.Row="1"
                      Background="Transparent"
                      BorderThickness="0"
                      ScrollViewer.HorizontalScrollBarVisibility="Disabled">
              <ListView.ItemTemplate>
                <DataTemplate>
                  <Border Padding="8" Margin="2" Background="#2A3A4A" CornerRadius="4">
                    <Grid>
                      <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                      </Grid.ColumnDefinitions>
                      <CheckBox Grid.Column="0" 
                                IsChecked="{Binding Selected, Mode=TwoWay}" 
                                VerticalAlignment="Center"/>
                      <StackPanel Grid.Column="1" Margin="12,0">
                        <TextBlock Text="{Binding DisplayName}" FontWeight="Bold" Foreground="White"/>
                        <TextBlock Text="{Binding Publisher}" Foreground="#888888" FontSize="11"/>
                      </StackPanel>
                      <Border Grid.Column="2" 
                              Background="{Binding SourceColor}" 
                              CornerRadius="4" 
                              Padding="8,2"
                              VerticalAlignment="Center">
                        <TextBlock Text="{Binding Source}" FontSize="10" Foreground="White"/>
                      </Border>
                    </Grid>
                  </Border>
                </DataTemplate>
              </ListView.ItemTemplate>
            </ListView>
          </Grid>
        </Border>
        
            <StackPanel Grid.Row="2" Margin="20,16,20,0">
              <TextBlock Text=" Les applications seront installées via winget ou RuckZuck avant la restauration des données."
                         TextWrapping="Wrap"
                         Foreground="#AAAAAA"
                         FontSize="11"
                         HorizontalAlignment="Center"/>
            </StackPanel>
          </Grid>
        </ScrollViewer>
      </Grid>

      <!-- PAGE PASSWORDS : Mots de passe navigateurs -->
      <Grid Name="pagePasswords" Visibility="Collapsed">
        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Padding="20">
          <StackPanel HorizontalAlignment="Center" MaxWidth="900">
            <TextBlock Name="lblPwTitle"
                       Text=" Export des mots de passe navigateurs"
                       FontSize="20"
                       FontWeight="Bold"
                       HorizontalAlignment="Center"
                       Margin="0,20,0,24"/>

            <UniformGrid Name="gridPwTiles"
                         Columns="3"
                         Margin="0,0,0,32"
                         HorizontalAlignment="Center"/>

            <Border Background="{StaticResource PanelDark}"
                    BorderBrush="{StaticResource Accent}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="16"
                    Margin="0,0,0,20">
              <StackPanel Name="stackPwInstructions" MaxHeight="500">
                <TextBlock FontWeight="Bold" Margin="0,0,0,12" FontSize="14"> Comment exporter les mots de passe :</TextBlock>
                <!-- Les instructions seront ajoutées dynamiquement ici selon les navigateurs détectés -->
              </StackPanel>
            </Border>
          </StackPanel>
        </ScrollViewer>
      </Grid>
      
      <!-- PAGE 3 : Résumé + Configuration -->
      <Grid Name="page3" Visibility="Collapsed">
        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
          <StackPanel>
            <!-- Panel Export -->
            <StackPanel Name="panelExport" Visibility="Collapsed" Margin="0,0,0,12">
              <GroupBox Header=" Configuration Export">
                <Grid Background="{StaticResource PanelDark}">
                  <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                  </Grid.RowDefinitions>

                  <StackPanel Grid.Row="0" Margin="8">
                    <TextBlock Text="Nom du client (nom du dossier d'export) :" Margin="0,0,0,4"/>
                    <TextBox Name="tbClientName" />
                  </StackPanel>

                  <StackPanel Grid.Row="1" Margin="8">
                    <TextBlock Text="Dossier destination :" Margin="0,0,0,4"/>
                    <DockPanel>
                      <Button Name="btnPickExport" Content=" Parcourir..." DockPanel.Dock="Right" Width="120"/>
                      <TextBox Name="tbExportDest" IsReadOnly="True"/>
                    </DockPanel>
                  </StackPanel>
                </Grid>
              </GroupBox>
            </StackPanel>

            <!-- Panel Import -->
            <StackPanel Name="panelImport" Visibility="Collapsed" Margin="0,0,0,12">
              <GroupBox Header=" Configuration Import">
                <Grid Background="{StaticResource PanelDark}">
                  <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                  </Grid.RowDefinitions>

                  <StackPanel Grid.Row="0" Margin="8">
                    <TextBlock Text="Dossier client (export source) :" Margin="0,0,0,4"/>
                    <DockPanel>
                      <Button Name="btnPickImport" Content=" Parcourir..." DockPanel.Dock="Right" Width="120"/>
                      <TextBox Name="tbImportSrc" IsReadOnly="True"/>
                    </DockPanel>
                  </StackPanel>

                  <StackPanel Grid.Row="1" Margin="8">
                    <TextBlock Text="Nom du client détecté :" Margin="0,0,0,4"/>
                    <TextBox Name="tbImportClient" IsReadOnly="True" Background="#1a1a2e"/>
                  </StackPanel>
                </Grid>
              </GroupBox>
            </StackPanel>

            <!-- Résumé -->
            <GroupBox Header=" Résumé avant exécution" Margin="0,0,0,12">
              <StackPanel Background="{StaticResource PanelDark}">
                <TextBox Name="txtSummary"
                         IsReadOnly="True"
                         TextWrapping="Wrap"
                         VerticalScrollBarVisibility="Auto"
                         HorizontalScrollBarVisibility="Disabled"
                         MinHeight="250"
                         MaxHeight="400"
                         Margin="8"
                         FontFamily="Consolas"
                         FontSize="12"/>

                <StackPanel Orientation="Horizontal" Margin="8,8,8,8">
                  <CheckBox Name="cbConfirm"
                            Content="OK  Je confirme ce plan d'exécution"
                            IsChecked="False"
                            FontWeight="Bold"
                            FontSize="14"/>
                </StackPanel>
              </StackPanel>
            </GroupBox>
          </StackPanel>
        </ScrollViewer>
      </Grid>
      
      <!-- PAGE 4 : Exécution -->
      <Grid Name="page4" Visibility="Collapsed">
        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
          <StackPanel>
            <TextBlock Text="...  Exécution en cours..." FontSize="20" FontWeight="Bold" Margin="0,0,0,16"/>

            <ProgressBar Name="progressBar"
                         Height="24"
                         Minimum="0"
                         Maximum="100"
                         Margin="0,0,0,8"/>

            <Label Name="lblProgress"
                   Content="Initialisation..."
                   FontSize="13"
                   Margin="0,0,0,16"/>

            <CheckBox Name="cbPlaySound"
                      Content=" Jouer un son à la fin"
                      IsChecked="True"
                      Margin="0,0,0,12"/>

            <!-- Animation Nyan Cat -->
            <GroupBox Header=" Migration en cours..." Name="grpAnimation">
              <Grid Background="#1a1a2e" Height="300">
                <Viewbox Stretch="Uniform" MaxWidth="400" MaxHeight="250">
                  <Image Name="imgNyanCat" Stretch="Uniform"/>
                </Viewbox>
              </Grid>
            </GroupBox>
          </StackPanel>
        </ScrollViewer>
      </Grid>
      
      <!-- PAGE 5 : Terminé -->
      <Grid Name="page5" Visibility="Collapsed">
        <ScrollViewer VerticalScrollBarVisibility="Auto">
          <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Margin="0,0,0,12">
          <TextBlock Text="OK  Terminé avec succès !" 
                     FontSize="32" 
                     FontWeight="Bold" 
                     HorizontalAlignment="Center"
                     Margin="0,0,0,32"/>
          
          <Border Background="{StaticResource PanelDark}" 
                  BorderBrush="{StaticResource Accent}" 
                  BorderThickness="2" 
                  CornerRadius="12" 
                  Padding="32"
                  MinWidth="500">
            <StackPanel>
              <TextBlock Text=" Journal détaillé disponible" 
                         FontSize="16" 
                         FontWeight="Bold"
                         Margin="0,0,0,16"/>
              
              <TextBlock Margin="0,0,0,12">
                <Run Text="Fichier log : "/>
                <Hyperlink Name="hlLog" Foreground="#64b5f6">
                  <Run Text="Ouvrir le journal"/>
                </Hyperlink>
              </TextBlock>
              
              <TextBlock Name="lblLogPath" 
                         Foreground="#a8b2d1" 
                         TextWrapping="Wrap"
                         FontSize="11"
                         FontFamily="Consolas"/>
            </StackPanel>
          </Border>
          </StackPanel>
        </ScrollViewer>
      </Grid>

    </Grid>
    
    <!-- Barre de navigation (bas) -->
    <DockPanel Grid.Row="2" Margin="0,16,0,0">
      <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" HorizontalAlignment="Right">
        <Button Name="btnPrev" Content="&lt;  Précédent" MinWidth="110"/>
        <Button Name="btnNext" Content="Suivant &gt; " MinWidth="110"/>
        <Button Name="btnRun" Content=" Lancer" Visibility="Collapsed" MinWidth="110"/>
        <Button Name="btnClose" Content="X  Fermer" Visibility="Collapsed" MinWidth="110"/>
      </StackPanel>
    </DockPanel>
    
  </Grid>
</Window>
